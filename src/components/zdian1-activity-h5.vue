<style>
body {
  background-color: #000 !important;
  font-family: '微软雅黑';
}

input {
  outline: none;
}

.ui-six .lottery-box .inner_01>ul li {
  width: 167px;
  height: 140px;
  margin: 2px 3px;
  border-radius: 15px;
}

.ui-six .lottery-box .inner_01>ul {
  width: 520px;
  margin: 0 auto;
}

.ui-six .lottery-box .inner_01>ul li.b1 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg1.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.b2 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg3.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.b3 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg9.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.b4 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg7.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.b5 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg2.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.b6 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg6.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.b7 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg4.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.b8 {
  background: url("../assets/images/zdian1-activity/web-lottery-bg8.png") 0 0 no-repeat;
}

.ui-six .lottery-box .inner_01>ul li.btn-lottery {
  background: url("../assets/images/zdian1-activity/web-lottery-bg5.png") 0 0 no-repeat;
}

.fz20 {
  font-size: 20px;
}

.fz22 {
  font-size: 22px;
}

.fz24 {
  font-size: 24px;
}

.fz26 {
  font-size: 26px;
}

.fz30 {
  font-size: 30px;
}

.mt10 {
  margin-top: 10px;
}

.lh40 {
  line-height: 40px;
}

.mt20 {
  margin-top: 20px;
}

.pop-top span {
  color: #b4113c;
}

.pop-top h3 {
  font-size: 30px;
  color: #992d01;
}

.cl1 {
  color: #cb7d37;
}
</style>
<style lang="scss" scoped>
@import '../assets/css/reset.css';
.box {
    width: 7.5rem;
}
.ui-block-inner {
    width: 100%;
    height: auto;
    margin-left: auto;
    margin-right: auto;
    position: relative;
}
.ui-rect {
    position: absolute;
    display: inline-block;
    background: url("https://i.alipayobjects.com/e/201309/11htyhgbGn.gif") repeat;
}
.ui-textarea {
    position: absolute;
    font: 12px/1.5 "simsun";
}
.ui-textarea p {
    margin-bottom: 10px;
}
.ui-five,
.ui-four,
.ui-one,
.ui-seven,
.ui-six,
.ui-three,
.ui-two {
    position: absolute;
}
.ui-one {
    width: 7.50rem;
    height: 5.58rem;
    background: url("../assets/images/zdian1-activity/section-1.jpg") center top no-repeat;
    background-size: 100%;
    left: 0;
    top: 0;
}
.ui-two {
    width: 7.50rem;
    height: 3.74rem;
    background: url("../assets/images/zdian1-activity/section-2-1.jpg") center top no-repeat;
    background-size: 100% 100%;
    left: 0;
    top: 5.58rem;
}
.ui-three {
    width: 7.50rem;
    height: 4.76rem;
    background: url("../assets/images/zdian1-activity/section-3.jpg") center top no-repeat;
    background-size: 100%;
    left: 0;
    top: 9.32rem;
    position: relative;
}
.ui-four {
    width: 7.50rem;
    height: 9rem;
    background: url("../assets/images/zdian1-activity/section-4.jpg") center top no-repeat;
    background-size: 100%;
    left: 0;
    top: 12.68rem;
    .bg4-text {
        color: #daad3d;
        position: absolute;
        font-size: 0.18rem;
        top: 3.23rem;
        left: 0.5rem;
        li {
            padding-bottom: 0.07rem;
            padding-left: 0.09rem;
        }
    }
    img {
        position: absolute;
        width: 5.46rem;
        height: 2.9rem;
        top: 5.29rem;
        left: 1.02rem;
    }
    a {
        width: 2.15rem;
        height: 0.66rem;
        position: absolute;
        left: 2.64rem;
        bottom: 3.30rem;
    }
}
.ui-five {
    width: 7.50rem;
    height: 8.48rem;
    background: url("../assets/images/zdian1-activity/section-5.jpg") center top no-repeat;
    background-size: 100%;
    left: 0;
    top: 21.54rem;

}
.ui-six {
    width: 7.50rem;
    height: 11.35rem;
    background: url("../assets/images/zdian1-activity/section-6.jpg") center top no-repeat;
    background-size: 100%;
    left: 0;
    top: 29.62rem;
    h5 {
        width: 100%;
        text-align: center;
        font-size: 0.24rem;
        color: #821800;
        position: absolute;
        top: 2.15rem;
    }
}
.ui-seven {
    width: 7.50rem;
    height: 5.09rem;
    background: url("../assets/images/zdian1-activity/section-7-1.jpg") center top no-repeat;
    background-size: 100%;
    left: 0;
    top: 41.07rem;
}
[class^="text-"] {
    letter-spacing: 0.25rem;
    width: 1.22rem;
    overflow: hidden;
    display: inline-block;
    vertical-align: middle;
}
.footer {
    width: 7.5rem;
    height: 2.19rem;
    background: url("../assets/images/zdian1-activity/h5-footer-bg.png") center 0 no-repeat;
    background-size: 100%;
    position: fixed;
    bottom: 0;
    z-index: 10;
}
.footer-btn {
    display: block;
    width: 2.19rem;
    height: 0.66rem;
    position: absolute;
    top: 1.38rem;
    left: 2.94rem;
}
.box-con {
    position: absolute;
    width: 6.8rem;
    transform-origin: left top;
    top: 0.05rem;
    left: 0.34rem;
}
.nav {
    width: 1.66rem;
    height: 2.46rem;
    background: url("../assets/images/zdian1-activity/h5-nav-bg.png") 0 0 no-repeat;
    background-size: 100%;
    position: fixed;
    top: 50%;
    right: 0;
    margin-top: -1.23rem;
    z-index: 10;
    padding-top: 1.03rem;
}
.nav a {
    width: 100%;
    height: 0.48rem;
    float: left;
}
.bg5-text {
    position: absolute;
    color: #151311;
    font-size: 0.24rem;
    width: 6.6rem;
    top: 5.29rem;
    left: 0.6rem;
    li {
        padding-bottom: 0.03rem;
    }
    li:nth-child(2) {
        padding-left: 0.25rem;
    }
    li:nth-child(3) {
        padding-left: 0.74rem;
    }
}
.lottery-box {
    position: absolute;
    top: 2.86rem;
    width: 6.98rem;
    height: 5.17rem;
    left: 0.61rem;
}
.announce-box {
    position: absolute;
    top: 8.9rem;
    width: 100%;
    text-align: center;
    font-size: 0.24rem;
    p {
        color: #ffe4c3;
        font-size: 0.35rem;
    }
    & > div {
        position: relative;
        overflow: hidden;
    }
    .cur {
        font-size: 0.26rem;
        color: #efb351;
    }
}
.bg6-text {
    font-size: 0.22rem;
    color: #e5b880;
    position: absolute;
    top: 0.7rem;
    left: 0.7rem;
    width: 6.5rem;
}
.shareInBrowser {
    width: 100%;
    position: fixed;
    top: 0;
    left: 0;
    background: url("https://i0.jrjimg.cn/activity/strategy-fans/img/shareInBrowser.png");
    background-size: 100% 100%;
    z-index: 9999;
    display: none;
}
.bg2-text {
    font-size: 0.22rem;
    color: #161412;
    position: absolute;
    top: 0.4rem;
    left: 0.2rem;
}
a.link1 {
    height: 0.6rem;
    width: 1.6rem;
    left: 1.9rem;
    top: 3.6rem;
    display: block;
    position: absolute;
}
a.link2 {
    right: 0.29rem;
    top: 3.6rem;
    height: 0.6rem;
    width: 1.6rem;
    display: block;
    position: absolute;
}
</style>
<style>
#divdown1 {
  position: absolute;
  color: white;
  width: 6rem;
  font-size: .52rem;
  top: .57rem;
  left: 1.05rem;
  font-family: Consolas, Monaco, monospace;
}

#divdown1 .time-unit {
  color: #980d00;
  font-size: .36rem;
  padding-right: .16rem;
}
</style>

<template>
<div class="box">
  <div class="ui-block-inner">
    <div class="ui-one"></div>
    <div class="ui-two">
    </div>
    <div class="ui-three">
      <div class="box-con" ref="slideBox">
        <activity-slider :listData="listData" />
      </div>
    </div>
    <div class="ui-four" id="d0">
      <a href="javascript:;" @click="free">&nbsp;</a>
      <img src="http://i0.jrjimg.cn/assets/images/zdian/zdxh.png" />
    </div>
    <div class="ui-five" id="d1">
      <a href="http://itougu.jrj.com.cn/tips/438.jspa" class="link1" @click="grab('1')"></a>
      <a href="http://itougu.jrj.com.cn/tips/439.jspa" class="link2" @click="grab('2')"></a>
    </div>
    <div class="ui-six" id="d2">
      <h5>您有 {{lotteryInfo.drawNum || 0}} 次抽奖机会</h5>
      <div class="lottery-box" ref="lotteryBox">
        <lottery @start="playLottery" @stop="showLotteryResult" :prize="prize" :box-width="lotteryBoxWidth" />
      </div>
      <div class="announce-box">
        <p>目前已有 {{lotteryInfo.joinNum || 0}} 人参与</p>
        <div v-if="lotteryInfo.prizeUserList && lotteryInfo.prizeUserList.length > 0">
          <ul>
            <li v-for="item of lotteryInfo.prizeUserList">恭喜{{item.userName}}抽中{{item.pname}}，祝您投资愉快。</li>
          </ul>
        </div>
        <div v-else style="color:#ffe4c3">暂无人中奖</div>
      </div>
    </div>
    <div class="ui-seven">
    </div>
  </div>
  <div class="nav">
    <a href="javascript:;" data-index="0"></a>
    <a href="javascript:;" data-index="1"></a>
    <a href="javascript:;" data-index="2"></a>
  </div>
  <zdian1-activity-pop1 @close="pop1Close" v-if="pop1Show">
    <div v-html="pop1Html">

    </div>
  </zdian1-activity-pop1>
  <zdian1-activity-pop2 @pop2Close="pop2Close" v-if="pop2Show">
    <div v-html="pop2Html">

    </div>
  </zdian1-activity-pop2>
  <div class="footer">
    <div class="box-con">
      <div id="divdown1">
        <span id="text-day" class="text-day"></span>
        <span id="text-hour" class="text-hour"></span>
        <span id="text-min" class="text-min"></span>
        <span id="text-sec" class="text-sec"></span>
      </div>
    </div>
    <a class="footer-btn" href="javascript:;" @click="scrollTo(1)"></a>
  </div>
  <div class="shareInBrowser" ref="shareLayer" @click="hideShareLayer"></div>
</div>
</template>
<script>
import {
  mapState
} from 'vuex'
import jQuery from 'jquery'
window.jQuery = window.$ = jQuery
import activitySlider from 'components/activity-slider'
import lottery from 'components/lottery'
import zdian1ActivityPop1 from 'components/zdian1-activity-pop1'
import zdian1ActivityPop2 from 'components/zdian1-activity-pop2'

export default {
  data () {
    return {
      listData: {
        conWidth: '980px',
        conHeight: '399px',
        conPadding: '0',
        pagShow: true,
        arrowShow: false,
        paginationClickable: true,
        loop: true,
        autoplay: 2000,
        autoplayDisableOnInteraction: false,
        list: [{
          imgUrl: 'http://i0.jrjimg.cn/assets/images/zdian/1-1.jpg',
          link: ''
        },
        {
          imgUrl: 'http://i0.jrjimg.cn/assets/images/zdian/1-2.jpg',
          link: ''
        },
        {
          imgUrl: 'http://i0.jrjimg.cn/assets/images/zdian/1-3.jpg',
          link: ''
        },
        {
          imgUrl: 'http://i0.jrjimg.cn/assets/images/zdian/1-4.jpg',
          link: ''
        }
        ]
      },
      lotteryBoxWidth: 0,
      pop1Show: false,
      pop1Html: '',
      pop2Show: false,
      pop2Html: '',
      prize: -1
    }
  },
  computed: mapState({
    loginStatus: state => state.user.loginStatus,
    err: state => state.actZdfl.err,
    lotteryInfo: state => state.actZdfl.lotteryInfo || {},
    lotteryResult: state => state.actZdfl.lotteryResult
  }),
  components: {
    activitySlider,
    lottery,
    zdian1ActivityPop1,
    zdian1ActivityPop2
  },
  methods: {
    scrollTo (n) {
      var pos = $('#d' + n).offset().top
      // 实现平滑移动 1000代表时间ms
      $('html,body').stop().animate({
        scrollTop: pos
      }, 500)
    },
    playLottery () {
      if (window.app.name === '{{appid}}') {
        if (window.navigator.userAgent.toLowerCase().indexOf('micromessenger') !== -1) {
          this.showShareLayer()
        } else {
          window.location = 'jrjnews://tougu?t=web&url=http://itougu.jrj.com.cn/actm/zdian1-activity'
          setTimeout(function () {
            window.location = 'http://sjcms.jrj.com.cn/app_tg.php?channel=V4V6497Y9&tgqdcode=3Q2Y3H95'
          }, 1500)
        }
      } else {
        if (this.loginStatus === 'no') {
          window.jrj.jsCallNative('108', JSON.stringify({
            returnUrl: encodeURI(window.location.href)
          }))
        } else {
          if (!this.lotteryInfo || !this.lotteryInfo.drawNum) {
            this.pop2Html = '<h3>很遗憾<br />您当前没有抽奖机会</h3><p class="fz26 cl1">参与现金券抢购，</p><p class="fz20 cl1">可以获取更多抽奖机会哟~</p><p class="fz20 cl1">祝您投资愉快</p>'
            this.pop2Show = true
            return
          }
          this.prize = -1
          this.$store.dispatch('actZdfl/playLottery').then(() => {
            if (!this.err) {
              this.prize = this.lotteryResult.prizePosition * 1
            }
            this.$store.dispatch('actZdfl/getLotteryInfo')
          })
        }
      }
    },
    showLotteryResult () {
      if (this.prize > 0) {
        if (this.prize === 8) {
          this.pop2Html = '<h3>遗憾了！<br />大奖与您擦肩而过</h3><p class="fz26 cl1">继续参与现金券抢购，</p><p class="fz20 cl1">可以获得更多抽奖机会。~</p><p class="fz20 cl1">祝您投资愉快</p>'
        } else {
          this.pop2Html = '<h3>恭喜您！<br />成功抽取 ' + this.lotteryResult.prizeName + '</h3><p class="fz20 cl1">奖品将于3个工作日内派发，您可以</p><p class="fz20 cl1">前往APP活动页面“我的礼品”~</p><p class="fz20 cl1">里查看中奖记录。</p>'
        }
        this.pop2Show = true
      } else {
        this.pop2Show = false
      }
    },
    pop1Close () {
      this.pop1Html = ''
      this.pop1Show = false
    },
    pop2Close () {
      this.pop2Html = ''
      this.pop2Show = false
    },
    hideShareLayer () {
      this.$refs.shareLayer.style.display = 'none'
    },
    showShareLayer () {
      this.$refs.shareLayer.style.display = 'block'
      this.$refs.shareLayer.style.height = $(window).height() + 'px'
    },
    free () {
      if (window.app.name === '{{appid}}') {
        if (window.navigator.userAgent.toLowerCase().indexOf('micromessenger') !== -1) {
          this.showShareLayer()
        } else {
          window.location = 'jrjnews://tougu?t=web&url=http://itougu.jrj.com.cn/actm/zdian1-activity'
          setTimeout(function () {
            window.location = 'http://sjcms.jrj.com.cn/app_tg.php?channel=V4V6497Y9&tgqdcode=3Q2Y3H95'
          }, 1500)
        }
      } else {
        if (this.loginStatus === 'no') {
          window.jrj.jsCallNative('108', JSON.stringify({
            returnUrl: encodeURI(window.location.href)
          }))
        } else if (this.loginStatus === 'yes') {
          this.$store.dispatch('actZdfl/getZPoint').then(() => {
            if (this.err) {
              this.pop1Html = '<img src="http://i0.jrjimg.cn/zqt-red-1000/focus/zlhWeb/web-text1.png" /><p class="fz24 mt10">免费体验权限<span>仅限Z点操盘新用户</span>领取。</p><p class="fz30">您可以参与<span>“8元抢购”</span>福利，<br />享受超低折扣~</p>'
            } else {
              this.pop1Html = '<img src="http://i0.jrjimg.cn/zqt-red-1000/focus/zlhWeb/web-text2.png" /><p class="fz26 mt20">成功领取智能炒股择时工具</p><p class="fz26">Z点操盘7天免费使用权限。</p><p class="fz20">您可以在金融界APP“智能选股”页查看并使用。</p>'
            }
            this.pop1Show = true
          })
        } else {
          alert('正在获取用户信息，请稍候')
        }
      }
    },
    grab (type) {
      this.pop1Html = '<img src="http://i0.jrjimg.cn/zqt-red-1000/focus/zlhWeb/web-text3.png" /><p class="fz22 mt20 lh40">现金券将在次日发放，如遇节假日则顺延；</p><p class="fz22 lh40">此现金券可用于订阅智能炒股择时工具Z点操<br />盘，请在个人中心查看并使用。</p>'
      // this.pop1Show = true
    }
  },
  mounted () {
    document.title = 'Z点操盘送三大福利-金融界'
    this.$store.dispatch('user/checkLogin').then(() => {
      this.$store.dispatch('actZdfl/getLotteryInfo')
    })
    $(this.$refs.slideBox).css({
      transform: `scale(${$(this.$refs.slideBox).width() / 980})`
    })
    setTimeout(() => {
      this.lotteryBoxWidth = $(this.$refs.lotteryBox).width()
    })

    function pad (str, len) {
      str = str + ''
      if (str.length < len) {
        for (let i = 0; i < len - str.length; i++) {
          str = '0' + str
        }
      }
      return str
    }

    function ShowCountDown (year, month, day, divname) {
      var now = new Date()
      var endDate = new Date(year, month - 1, day)
      var leftTime = endDate.getTime() - now.getTime()
      var leftsecond = parseInt(leftTime / 1000)
      var day1 = Math.floor(leftsecond / (60 * 60 * 24))
      var hour = Math.floor((leftsecond - day1 * 24 * 60 * 60) / 3600)
      var minute = Math.floor((leftsecond - day1 * 24 * 60 * 60 - hour * 3600) / 60)
      var second = Math.floor(leftsecond - day1 * 24 * 60 * 60 - hour * 3600 - minute * 60)
      document.getElementById('text-day').innerHTML = pad(day1, 2)
      document.getElementById('text-hour').innerHTML = pad(hour, 2)
      document.getElementById('text-min').innerHTML = pad(minute, 2)
      document.getElementById('text-sec').innerHTML = pad(second, 2)
    }
    window.setInterval(function () {
      ShowCountDown(2017, 10, 22, 'divdown1')
    }, 1000)
    $('.nav a').click(e => {
      var index = $(e.target).attr('data-index')
      this.scrollTo(index)
    })
    setInterval(function () {
      $('.ui-six .announce-box ul').animate({
        'margin-top': '-30px'
      }, 500, function () {
        $('.ui-six .announce-box ul li:first').css({
          'font-size': '.22rem'
        })
        $('.ui-six .announce-box ul').append($('.ui-six .announce-box ul li:first'))
        $('.ui-six .announce-box ul li:first').addClass('cur').siblings().removeClass('cur')
        $('.ui-six .announce-box ul').css({
          'margin-top': '0'
        })
      })
      $('.ui-six .announce-box ul li:eq(1)').animate({
        'font-size': '.26rem'
      }, 500)
    }, 1500)
    if (window.navigator.userAgent.toLowerCase().indexOf('micromessenger') !== -1) {
      window.InitWeChatShare({
        shareTitle: 'Z点操盘送三大福利',
        shareLink: window.location.href,
        shareDesc: '金融界智能炒股工具Z点操盘送您三大福利，赢战“金九银十”',
        shareImg: 'http://i0.jrjimg.cn/assets/images/jzxg-300x300.jpg'
      })
    }
  }
}
</script>
